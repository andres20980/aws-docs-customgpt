name: Sync and Upload AWS Docs Submodules

on:
  push:
    branches:
      - main

jobs:
  sync-repos:
    runs-on: ubuntu-latest

    steps:
      # Paso 1: Checkout del repositorio
      - name: ğŸ“¥ Checkout del repositorio
        uses: actions/checkout@v4
        with:
          submodules: true
          fetch-depth: 0

      # Paso 2: Ver informaciÃ³n del repositorio (depuraciÃ³n)
      - name: ğŸ§‘â€ğŸ’» Ver informaciÃ³n del repositorio
        run: |
          echo "Verificando el estado de Git..."
          git status
          echo "ConfiguraciÃ³n remota de Git:"
          git remote -v
          
      # Paso 3: ConfiguraciÃ³n de Git para submÃ³dulos
      - name: ğŸ› ï¸ Configurar Git para submÃ³dulos
        run: |
          echo "Configurando Git para submÃ³dulos..."
          git config --global user.name "github-actions"
          git config --global user.email "github-actions@github.com"

      # Paso 4: Sincronizar submÃ³dulo
      - name: ğŸ”„ Sincronizar submÃ³dulo
        run: |
          echo "Sincronizando submÃ³dulos..."
          git submodule update --init --recursive

      # Paso 5: Procesar un submÃ³dulo y generar el archivo .md
      - name: ğŸ§‘â€ğŸ’» Procesar y generar archivo .md para el submÃ³dulo
        run: |
          echo "Ejecutando script para procesar los submÃ³dulos y generar .md"
          bash src/descargar_awsdocs.sh

      # Paso 6: Commit y push de cambios
      - name: ğŸ”„ Commit y push de cambios
        run: |
          echo "Realizando commit y push de cambios..."
          git add .
          if git diff --staged --quiet; then
            echo "No hay cambios para hacer commit."
          else
            git commit -m "ğŸ”„ ActualizaciÃ³n de submÃ³dulo y archivo .md"
            git push
